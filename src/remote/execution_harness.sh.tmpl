#!/usr/bin/env {shell}
# Execution harness: runs Python code in isolation and captures the result.
# Python communicates its response via a temp file to avoid any accidental
# collisions with logs the user code may emit to stdout.

# Create a unique temp file for IPC with PID to avoid conflicts
RESULT_FILE="/tmp/remote_execution_result_$$"
trap 'rm -f "$RESULT_FILE"' EXIT INT TERM

# Run Python and pass the result file path as an env var
# Redirect stdout and stderr to /dev/null to isolate from harness output
REMOTE_EXECUTION_MODE=1 REMOTE_EXECUTION_RESULT_FILE="$RESULT_FILE" {python_cmd} >/dev/null 2>&1 <<'EOF'
{code}
EOF

# Print the result to stdout (this is the only output from the harness)
cat "$RESULT_FILE"
